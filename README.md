# 🐳 Containerization

This document provides instructions for building and running a Docker container for the HL7-to-FHIR conversion workflow. Containerization ensures a consistent environment for deploying and running the application.

---

## Prerequisites
1. **Docker Installed:** Ensure Docker is installed and running on your system.
   - [Docker Installation Guide](https://docs.docker.com/get-docker/)
2. **Repository Setup:** Clone the repository and navigate to the root directory:
   ```bash
   git clone https://github.com/your-username/hl7-to-fhir.git
   cd hl7-to-fhir
   ```

---

## Dockerfile

The repository includes the following `Dockerfile` to containerize the HL7-to-FHIR transformation workflow:

```dockerfile
# Use a lightweight Python image
FROM python:3.9-slim

# Set environment variables
ENV PYTHONUNBUFFERED=1

# Install required Python libraries
RUN pip install requests hl7apy

# Copy the application code
COPY ./examples /app/examples
COPY ./scripts /app/scripts

# Set the working directory
WORKDIR /app

# Default command to run the transformation script
CMD ["python", "scripts/transform_hl7_to_fhir.py"]
```

---

## Build the Docker Image

To build the Docker image, run the following command from the root directory of the repository:
```bash
docker build -t hl7-to-fhir .
```

### Output Example:
```bash
Sending build context to Docker daemon  10.24kB
Step 1/6 : FROM python:3.9-slim
 ---> e5b731a5999e
Step 2/6 : ENV PYTHONUNBUFFERED=1
 ---> Using cache
 ---> b6c1a53e94bd
Step 3/6 : RUN pip install requests hl7apy
 ---> Running in 43c7c8fddf73
...
Successfully tagged hl7-to-fhir:latest
```

---

## Run the Docker Container

Run the Docker container with the following command:
```bash
docker run -v $(pwd)/examples:/app/examples hl7-to-fhir
```

### Command Breakdown:
- `-v $(pwd)/examples:/app/examples`: Mounts the `examples` directory from your local machine into the container for easy access to sample files.
- `hl7-to-fhir`: Specifies the name of the Docker image to run.

### Expected Output:
The container will execute the `transform_hl7_to_fhir.py` script and display the transformation results or any logs related to the process.

---

## Verify the Container Workflow
1. **Inspect Logs:** Use the `docker logs` command to check container output:
   ```bash
   docker logs <container-id>
   ```
2. **Access Transformed Files:** Check the mounted `examples` directory for output files generated by the container.

---

## Stopping and Cleaning Up
1. **Stop the Container:**
   ```bash
   docker stop <container-id>
   ```
2. **Remove the Container:**
   ```bash
   docker rm <container-id>
   ```
3. **Remove the Docker Image:**
   ```bash
   docker rmi hl7-to-fhir
   ```

---

## Notes
- Ensure all sample HL7 and expected FHIR JSON files are located in the `examples` directory.
- Update the `Dockerfile` if additional dependencies are required for your workflow.

By containerizing the HL7-to-FHIR conversion workflow, you ensure a portable and reproducible environment for testing and deployment.
